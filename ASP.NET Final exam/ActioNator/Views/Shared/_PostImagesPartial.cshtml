@using ActioNator.ViewModels.Community
@model IEnumerable<PostImageViewModel>

@if (Model != null && Model.Any())
{
    <div class="post-media-container bg-gray-200" x-data="postImagesHandler()" data-images='@Html.Raw(Json.Serialize(Model))' x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 transform scale-95" x-transition:enter-end="opacity-100 transform scale-100">
        <div class="dynamic-image-grid" :class="getGridClass()">
            <template x-for="(image, index) in displayedImages" :key="index">
                <div class="relative overflow-hidden bg-gray-200 cursor-pointer group" @@click ="openImageModal(index)" :class="getImageContainerClass(index)">
                    <img :src="image.url" :alt="image.alt || 'Post image'" class="w-full h-full object-cover transition-transform duration-200 group-hover:scale-105" @@error ="handleImageError($event, index)" onerror="this.onerror=null; this.src='/images/placeholder-image.png';">

                    <!-- Overlay for additional images (+N) -->
                    <template x-if="index === 2 && postImages.length > 3">
                        <div class="absolute inset-0 bg-black bg-opacity-60 flex items-center justify-center text-white font-bold text-xl transition-opacity duration-200 group-hover:bg-opacity-50">
                            <span x-text="'+' + (postImages.length - 3)"></span>
                        </div>
                    </template>

                    <!-- Loading placeholder -->
                    <div x-show="image.loading" class="absolute inset-0 bg-gray-300 animate-pulse flex items-center justify-center">
                        <svg class="w-8 h-8 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd"></path>
                        </svg>
                    </div>
                </div>
            </template>
        </div>
    </div>
}
 
