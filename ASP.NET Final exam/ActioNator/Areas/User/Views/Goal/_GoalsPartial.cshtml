@using ActioNator.ViewModels.Goal
@model GoalsListViewModel

<!-- Pagination Controls -->
<div class="w-full basis-full">
    @if (Model.TotalPages > 1)
    {
        <nav class="w-full mt-2 mb-2 flex items-center justify-center space-x-2 select-none mx-auto" aria-label="Pagination">
            <button type="button"
                    class="px-3 py-1 rounded border text-sm disabled:opacity-50"
                    data-action="prev"
                    @@click="prevPage()" @(Model.Page <= 1 ? "disabled" : null)>
                Prev
            </button>

            @for (int p = 1; p <= Model.TotalPages; p++)
            {
                <button type="button"
                        class="px-3 py-1 rounded border text-sm @(p == Model.Page ? "bg-indigo-600 text-white border-indigo-600" : "bg-white text-gray-700")"
                        data-page="@p"
                        @@click="goToPage(@p)">
                    @p
                </button>
            }

            <button type="button"
                    class="px-3 py-1 rounded border text-sm disabled:opacity-50"
                    data-action="next"
                    @@click="nextPage()" @(Model.Page >= Model.TotalPages ? "disabled" : null)>
                Next
            </button>
        </nav>
    }

    <div id="paginationContainer"
         data-current-page="@Model.Page"
         data-total-pages="@Model.TotalPages"
         data-page-size="@Model.PageSize"
         class="w-full hidden">
    </div>
</div>

@if (Model?.Goals != null && Model.Goals.Any())
{
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-8 w-full">
    @foreach (var goal in Model.Goals)
    {
        <div class="goal-card bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300" data-id="@goal.Id" data-status="@(goal.Completed ? "completed" : "active")">
            <div class="goal-card-inner p-6">
                <!-- Card Header -->
                <div class="goal-card-header relative mb-3">
                    <h3 class="goal-title text-lg font-semibold text-gray-800 pr-10 whitespace-pre-line break-words" title="@goal.Title">@goal.Title</h3>
                    <div class="goal-actions dropdown-container absolute top-0 right-0">
                        <button type="button" class="goal-menu-btn dropdown-trigger p-2 rounded-full hover:bg-gray-100 cursor-pointer relative z-30" aria-label="Goal options">
                            <i class="fas fa-ellipsis-v"></i>
                        </button>
                        <div class="dropdown-menu absolute right-0 mt-1 w-48 rounded-lg shadow-lg bg-white border border-gray-200 z-30" style="opacity: 0; visibility: hidden; transform: translateY(-10px); transition: opacity 0.2s ease, transform 0.2s ease; display: block; pointer-events: none;">
                            <div class="py-2 px-1">
                                <button type="button" class="dropdown-item edit-goal-btn w-full text-left px-4 py-2.5 rounded-md hover:bg-gray-100 flex items-center" data-id="@goal.Id">
                                    <i class="fas fa-edit mr-3 text-gray-700"></i>
                                    <span>Edit</span>
                                </button>
                                <button type="button" class="dropdown-item delete-goal-btn w-full text-left px-4 py-2.5 rounded-md hover:bg-gray-100 flex items-center text-red-500" data-id="@goal.Id">
                                    <i class="fas fa-trash-alt mr-3"></i>
                                    <span>Delete</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Card Body -->
                <div class="goal-card-body mb-4">
                    @if (!string.IsNullOrEmpty(goal.Description))
                    {
                        <div class="goal-description-container flex flex-col space-y-2">
                            <p class="goal-description text-gray-600 text-sm whitespace-pre-wrap overflow-hidden transition-all duration-300 pb-6">@goal.Description</p>
                            <button class="read-more-btn text-xs text-indigo-600 hover:text-indigo-800 self-start font-medium transition-all duration-200">
                                <span class="read-more">Read More</span>
                                <span class="read-less hidden">Show Less</span>
                            </button>
                        </div>
                    }
                    else
                    {
                        <p class="goal-description text-gray-500 text-sm italic">No description provided</p>
                    }
                </div>

                <!-- Card Footer -->
                <div class="goal-card-footer flex items-center justify-between pt-3 border-t border-gray-100">
                    <div class="goal-due-date text-sm @(goal.IsOverdue ? "text-red-600" : "text-gray-500")">
                        <i class="far fa-calendar-alt mr-1"></i>
                        <span>@goal.DueDateDisplay</span>
                        @if (goal.IsOverdue)
                        {
                            <span class="ml-1 text-xs font-medium">(Overdue)</span>
                        }
                    </div>

                    <div class="goal-status">
                        @if (goal.Completed)
                        {
                            <span class="status-badge completed bg-green-100 text-green-800 text-xs px-2.5 py-0.5 rounded-full whitespace-nowrap">
                                <i class="fas fa-check-circle mr-1"></i>Completed
                            </span>
                        }
                        else
                        {
                            <span class="status-badge active bg-blue-100 text-blue-800 text-xs px-2.5 py-0.5 rounded-full whitespace-nowrap">
                                <i class="fas fa-spinner mr-1"></i>Active
                            </span>
                        }
                    </div>
                </div>
            </div>
        </div>
    }
    </div>
}
else
{
    <div class="col-span-full text-center py-8">
        <p class="text-gray-500 dark:text-gray-400">No goals match the current filter.</p>
    </div>
}
